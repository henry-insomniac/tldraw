# 历史、事务与只读

历史（HistoryManager）
- `undo/redo`：packages/editor/src/lib/editor/Editor.ts:1721 起（方法位置接近）
- 批处理：`run(cb, opts?)` 将多个 put/update 合并到一个历史批次；UI 状态更新多以 `history:'ignore'` 写入。

事务（signals 级）
- `transact`：来自 `@tldraw/state`，对多原子/多记录更新提供原子性与回滚（Editor 内封装各 API）。

只读/锁定
- 相机锁：`cameraOptions.isLocked` 阻止滚轮/捏合/平移（packages/editor/src/lib/editor/Editor.ts:10440 前后）。
- 形状锁与只读：由工具/选择逻辑处理（例如忽略操作或变为移动画布）。

设计要点
- 历史只记录“文档状态”，UI/瞬时交互状态一律忽略，避免撤销操作污染交互。
- 批处理减少中间派生与订阅更新次数；大操作（多形状）必须在批处理中执行。

