# 输入系统与指针模型

输入系统负责将 DOM 事件转换为 Editor 的统一语义事件，并保持一份“输入镜像”。

输入镜像（inputs）
- 定义：packages/editor/src/lib/editor/Editor.ts:9467
- 字段：origin/current/previous（page/screen）坐标、pointerVelocity、isDragging/isPointing/isPinching/isEditing/isPanning/isSpacebarPanning、修饰键/按钮集等。

坐标更新
- `_updateInputsFromEvent(info)`：packages/editor/src/lib/editor/Editor.ts:9515
  - 屏幕→页面坐标换算（相机 + screenBounds）
  - pointerVelocity 管理、origin 点复位规则
  - 更新 `TLPOINTER`（指针记录）用于协作显示，`history:'ignore'`

事件调度与容错
- `dispatch(info)` 入队；非移动类事件立即 flush（packages/editor/src/lib/editor/Editor.ts:10177）
- `_flushEventsForTick(elapsed)` 调用 `root.handleEvent` 并驱动 `scribbles.tick`（:10203）
- 修饰键容错（150ms 延迟复位）：packages/editor/src/lib/editor/Editor.ts:10231 附近

设计要点
- `pointermove` 频繁：在 React 层通过 `useDocumentEvents` 直接绑定到 `document.body`，保证连续性（见 UI 层 hooks）。
- 事件去重：配合 `markEventAsHandled/wasEventAlreadyHandled` 避免同域组件对同一事件重复响应。
- 相机手势先行：pinch/wheel/pan 时优先处理相机，再交给工具状态机，避免逻辑冲突。

