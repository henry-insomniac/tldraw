# 渲染清单与缓存

Editor 将 Store 的记录转换为“渲染清单”，React 订阅后以最小代价更新 DOM/CSS。

渲染清单
- `getUnorderedRenderingShapes()`：构建包含 `id/shape/util/index/backgroundIndex/opacity` 的数组（packages/editor/src/lib/editor/Editor.ts:3972 起）。
- `getRenderingShapes()`：对清单排序与去重，供 UI 直接订阅（packages/editor/src/lib/editor/Editor.ts:4094）。

可见性与裁剪
- `getCulledShapes()`：结合 notVisibleShapes/选择/编辑态进行视口裁剪（packages/editor/src/lib/editor/Editor.ts:5020）。
- `isShapeHidden()` 与 `getShapeVisibility` 钩子共同决定是否渲染与命中。

矩阵与边界缓存（ComputedCache）
- `pageTransformCache`：packages/editor/src/lib/editor/Editor.ts:4659
- `pageBoundsCache`：packages/editor/src/lib/editor/Editor.ts:4715
- `pageMaskCache`/`clipPathCache`：packages/editor/src/lib/editor/Editor.ts:4816/4737

UI 层策略（简述）
- `DefaultCanvas`/`Shape` 组件只更新容器 `transform/width/height/opacity/display`，形状内部 JSX 使用 `useStateTracking` 稀疏重绘。
- 统一相机 transform 对齐 HTML/SVG 层，规避亚像素抖动。

设计要点
- 渲染清单解耦 UI 与数据：任何变更都先影响清单，再由 React 订阅精确更新。
- 缓存广泛应用：矩阵/边界/剪裁/清单皆有缓存，CPU 与内存平衡依赖 signals 的依赖裁剪能力。

