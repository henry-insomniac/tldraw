# 文本与字体系统

文本
- 富文本编辑：与 Tiptap 集成，当前编辑器实例存于 `_currentRichTextEditor` 原子（packages/editor/src/lib/editor/Editor.ts:2338）。
- 文本度量：`TextManager` 提供测量/布局，避免布局抖动与重复计算。

字体
- 管理器：`FontManager` 负责字体资源请求与预加载。
- 按需加载：UI 层 `Shape` 渲染时读取所需字体并请求加载（减少首帧阻塞）。

选区与编辑态
- `inputs.isEditing` 与 PageState.editingShapeId 协同，控制文本工具切换与输入法焦点。

设计要点
- 字体/文本是性能热点：尽量将度量与加载异步化，并通过缓存/延迟订阅降低渲染频率。
- 富文本与几何间的桥接需谨慎：文本框大小、换行、缩放等均会触发表达式更新。

