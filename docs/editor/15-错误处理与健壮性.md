# 错误处理与健壮性

崩溃通道
- `crash(error)`：记录 `_crashingError`，标记 `store.markAsPossiblyCorrupted()`，并 `emit('crash', { error })`（packages/editor/src/lib/editor/Editor.ts:10749 附近）。
- `_flushEventForTick` 初始处检查 `getCrashingError()`，若存在则直接返回，避免二次报错风暴（packages/editor/src/lib/editor/Editor.ts:10218 前后）。

错误注解
- `annotateError`：贯穿历史与渲染，用于上报与 UI ErrorBoundary 友好显示（UI 层 `OptionalErrorBoundary` 调用）。

事件去重
- `markEventAsHandled/wasEventAlreadyHandled`：阻止 tldraw 内部多层组件重复处理同一 DOM 事件（packages/editor/src/lib/editor/Editor.ts:10037 起）。

设计要点
- 将 crash 与正常路径强隔离：崩溃时暂停事件分发，避免“越错越多”。
- 错误注解形成统一格式，便于日志与用户可读性。

