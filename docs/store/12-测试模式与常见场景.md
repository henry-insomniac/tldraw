# 测试模式与常见场景

单元测试（src/lib/test/ 与同目录 *.test.ts）
- BaseRecord/RecordType：类型约束与默认值、校验覆盖
- RecordsDiff：合并/应用/逆操作正确性
- Store：CRUD、atomic 嵌套、副作用开关、history 推送
- StoreQueries/executeQuery：索引维护/表达式增量更新
- migrate：前向/回滚、依赖、错误处理

常见场景
- “创建→更新→删除”流水线：验证 before*/validate/after* 顺序与历史条目
- 远端合并：`atomic(..., runCallbacks=false, isMergingRemoteChanges=true)` + 自定义拦截器观测源标记
- 大列表查询：先建索引，再在表达式里组合；对 diff 的增量更新进行断言

建议
- 使用 `addHistoryInterceptor` 定位时序问题；
- 用 `__unsafe__getWithoutCapture` 在断言中避免额外依赖；
- 对迁移要构造真实旧数据样本，避免“只过 happy path”。

