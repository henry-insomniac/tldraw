# 常见陷阱与规避

1) 过度订阅
- 在热路径使用 `get()` 导致意外依赖，推荐 `unsafeGetWithoutCapture`；
- 在大集合上直接遍历 `records` 进行 computed，推荐走索引与表达式。

2) 副作用循环
- before*/after* 相互触发写入形成循环；在 atomic 中关闭 before* 或通过 flags 做保护；
- 在 operationComplete 再触发写入要小心再次进入 atomic。

3) 迁移疏漏
- 只实现 up 未实现 down；
- 忽略 subtype/嵌套对象；
- 未在真实数据上验证；出现“迁移通过但校验失败”的错配。

4) 监听风暴
- 对所有来源与作用域监听；建议 filters 指定 `source:'user'` 或限定 `scope`。

5) 事务范围错误
- 多条写入不在同一 atomic；导致历史碎片与副作用多次触发。

